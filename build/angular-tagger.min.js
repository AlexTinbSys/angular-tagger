/*! angular-tagger 2013-10-25 */
!function(){var a,b,c,d,e,f,g;for(angular.module("tagger",[]),f=[["ngKeydown","keydown"],["ngKeyup","keyup"]],c=function(a,b){return angular.module("tagger").directive(a,["$parse",function(c){return function(d,e,f){var g;return g=c(f[a]),e.bind(b,function(a){return d.$apply(function(){return g(d,{$event:a})})})}}])},d=0,e=f.length;e>d;d++)g=f[d],a=g[0],b=g[1],c(a,b);angular.module("tagger").directive("taggerContenteditable",function(){return{require:"ngModel",link:function(a,b,c,d){var e;return b.attr("contenteditable",!0),d.$render=function(){return b.text(d.$viewValue)},e=function(c){return 13===c.keyCode&&null!=c&&"function"==typeof c.preventDefault&&c.preventDefault(),a.$apply(function(){return d.$setViewValue(b.text())})},b.bind("keyup",e),b.bind("keydown",e)}}}),angular.module("tagger").directive("tagger",["$compile","$timeout",function(a,b){return{restrict:"AE",replace:!0,template:'<span class="angular-tagger">\n  <span class="angular-tagger__wrapper">\n    <span class="angular-tagger__holder" ng-repeat="tag in tags">\n      <span tagger-contenteditable="true"\n        ng-model="$parent.query"\n        ng-show="pos == $index"\n        ng-keydown="handleKeyDown($event)"\n        ng-keyup="handleKeyUp($event)"\n        ng-click="handleInputClick($event)"\n        class="angular-tagger__input">\n      </span>\n      <span class="angular-tagger__tag">\n        {{ tag }}\n        <span class="angular-tagger-tag__delete" ng-click="removeTag($index)">x</span>\n      </span>\n    </span>\n  </span>\n  <span tagger-contenteditable="true"\n    ng-model="query"\n    ng-show="pos == tags.length"\n    ng-keydown="handleKeyDown($event)"\n    ng-keyup="handleKeyUp($event)"\n    ng-click="handleInputClick($event)"\n    class="angular-tagger__input">\n  </span>\n  <div class="angular-tagger__hook">\n    <ul ng-show="expanded" class="angular-tagger__matching">\n      <li class="angular-tagger__matching-item"\n        ng-mouseover="selectItem(-1)"\n        ng-click="handleItemClick($event)"\n        ng-class=\'{"angular-tagger__matching-item--selected": selected == -1}\'>\n        Add: {{ query }}...\n      </li>\n      <li\n        ng-repeat="e in matching"\n        ng-mouseover="selectItem($index)"\n        ng-click="handleItemClick($event)"\n        class="angular-tagger__matching-item"\n        ng-class=\'{"angular-tagger__matching-item--selected": $index == selected}\'>\n        {{ e }}\n      </li>\n    </ul>\n  </div>\n</span>',scope:{tags:"=ngModel",options:"="},link:function(a,c){var d,e,f,g;return a.query="",a.expanded=!1,a.matching=[],a.selected=-1,a.pos=a.tags.length,d=c.children().eq(1),g=function(){var b,c,d,e,f,g,h,i,j,k,l;for(d=new RegExp(".*"+a.query.split("").join(".*")+".*","i"),a.matching=[],j=a.options,l=[],f=0,h=j.length;h>f;f++)if(c=j[f],d.test(c)){for(b=!1,k=a.tags,g=0,i=k.length;i>g;g++)e=k[g],e===c&&(b=!0);b?l.push(void 0):l.push(a.matching.push(c))}else l.push(void 0);return l},f=function(){return b(function(){return e().focus()})},e=function(){return a.pos===a.tags.length?d[0]:c.children().eq(0).children().eq(a.pos).children()[0]},a.handleKeyUp=function(b){var c;switch(b.keyCode){case 8:return g();case 46:return g();case 27:return a.hide();default:if(65<(c=b.keyCode)&&90>c)return g(),a.show(),a.selected=-1}},a.handleKeyDown=function(b){switch(b.keyCode){case 38:return a.selected=Math.max(a.selected-1,-1),b.preventDefault();case 40:return a.selected=Math.min(a.selected+1,a.matching.length-1),b.preventDefault();case 13:return a.addItem();case 8:if(""===a.query&&a.pos>0)return a.removeTag(a.pos-1);break;case 46:if(""===a.query&&a.pos<a.tags.length)return a.removeTag(a.pos);break;case 37:if(""===a.query)return a.pos=Math.max(a.pos-1,0),f();break;case 39:if(""===a.query)return a.pos=Math.min(a.pos+1,a.tags.length),f()}},a.handleInputClick=function(a){return a.stopPropagation()},a.handleItemClick=function(b){return a.addItem(),b.stopPropagation()},a.addItem=function(){return a.selected>-1||a.query?(-1===a.selected&&a.query?a.tags.splice(a.pos,0,a.query):a.selected>-1&&a.tags.splice(a.pos,0,a.matching[a.selected]),a.query="",g(),a.selected=Math.min(a.selected,a.matching.length-1),a.pos++,f()):void 0},a.selectItem=function(b){return a.selected=b},a.show=function(){return a.expanded=!0},a.hide=function(){return a.expanded=!1,e().blur(),a.pos=a.tags.length},a.removeTag=function(b){return a.tags.splice(b,1),b<a.pos&&a.pos--,g(),f()},angular.element(document).bind("click",function(){return a.$apply(function(){return a.hide()})}),g(),d.bind("focus",function(){return a.$apply(function(){return a.show()})})}}}])}.call(this);