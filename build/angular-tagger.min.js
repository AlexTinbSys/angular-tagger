/*! angular-tagger 2013-10-25 */
!function(){var a,b,c,d,e,f,g;for(angular.module("tagger",[]),f=[["ngKeydown","keydown"],["ngKeyup","keyup"]],c=function(a,b){return angular.module("tagger").directive(a,["$parse",function(c){return function(d,e,f){var g;return g=c(f[a]),e.bind(b,function(a){return d.$apply(function(){return g(d,{$event:a})})})}}])},d=0,e=f.length;e>d;d++)g=f[d],a=g[0],b=g[1],c(a,b);angular.module("tagger").directive("taggerContenteditable",function(){return{require:"ngModel",link:function(a,b,c,d){var e;return b.attr("contenteditable",!0),d.$render=function(){return b.text(d.$viewValue)},e=function(c){return 13===c.keyCode&&null!=c&&"function"==typeof c.preventDefault&&c.preventDefault(),a.$apply(function(){return d.$setViewValue(b.text())})},b.bind("keyup",e),b.bind("keydown",e)}}}),angular.module("tagger").directive("tagger",["$compile","$timeout",function(a,b){return{restrict:"AE",replace:!0,template:'<span class="angular-tagger" ng-click="handleOuterClick($event)">\n  <span class="angular-tagger__wrapper">\n    <span class="angular-tagger__holder" ng-repeat="tag in tags">\n      <span tagger-contenteditable="true"\n        ng-model="$parent.query"\n        ng-show="pos == $index"\n        ng-keydown="handleKeyDown($event)"\n        ng-keyup="handleKeyUp($event)"\n        ng-click="handleInputClick($event)"\n        class="angular-tagger__input">\n      </span>\n      <span class="angular-tagger__tag">\n        {{ config.displayFun(tag) }}\n        <span class="angular-tagger-tag__delete" ng-click="removeTag($index, $event)">x</span>\n      </span>\n    </span>\n  </span>\n  <span tagger-contenteditable="true"\n    ng-model="query"\n    ng-show="pos == tags.length"\n    ng-keydown="handleKeyDown($event)"\n    ng-keyup="handleKeyUp($event)"\n    ng-click="handleInputClick($event)"\n    class="angular-tagger__input">\n  </span>\n  <div class="angular-tagger__hook">\n    <ul ng-show="expanded" class="angular-tagger__matching">\n      <li class="angular-tagger__matching-item"\n        ng-mouseover="selectItem(-1)"\n        ng-click="handleItemClick($event)"\n        ng-hide="config.disableNew"\n        ng-class=\'{"angular-tagger__matching-item--selected": selected == -1}\'>\n        Add: {{ query }}...\n      </li>\n      <li\n        ng-repeat="e in matching"\n        ng-mouseover="selectItem($index)"\n        ng-click="handleItemClick($event)"\n        class="angular-tagger__matching-item"\n        ng-class=\'{"angular-tagger__matching-item--selected": $index == selected}\'>\n        {{ config.displayFun(e) }}\n      </li>\n    </ul>\n  </div>\n</span>',scope:{tags:"=ngModel",options:"="},link:function(a,c,d){var e,f,g,h;return a.query="",a.expanded=!1,a.matching=[],a.selected=-1,a.options||(a.options=[]),a.tags||(a.tags=[]),a.pos=a.tags.length,a.config={disableNew:!1,displayFun:function(a){return a},limit:null},null!=d.disableNew&&(a.config.disableNew=null!=d.disableNew),null!=d.limit&&(a.config.limit=parseInt(d.limit)),null!=d.displayFun&&(a.config.displayFun=a.$parent.$eval(d.displayFun)),a.config.disableNew&&(a.selected=0),e=c.children().eq(1),h=function(){var b,c,d,e,f,g,h,i,j,k,l;for(d=new RegExp(".*"+a.query.split("").join(".*")+".*","i"),a.matching=[],j=a.options,l=[],f=0,h=j.length;h>f;f++)if(c=j[f],d.test(c)){for(b=!1,k=a.tags,g=0,i=k.length;i>g;g++)e=k[g],e===c&&(b=!0);b?l.push(void 0):l.push(a.matching.push(c))}else l.push(void 0);return l},g=function(){return b(function(){return f().focus()})},f=function(){return a.pos===a.tags.length?e[0]:c.children().eq(0).children().eq(a.pos).children()[0]},a.handleOuterClick=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),g()},a.handleKeyUp=function(b){var c;switch(b.keyCode){case 8:return h();case 46:return h();case 27:return a.hide();default:if(65<(c=b.keyCode)&&90>c)return h(),a.show(),a.selected=a.config.disableNew?0:-1}},a.handleKeyDown=function(b){switch(b.keyCode){case 38:return a.selected=Math.max(a.selected-1,a.config.disableNew?0:-1),b.preventDefault();case 40:return a.selected=Math.min(a.selected+1,a.matching.length-1),b.preventDefault();case 13:return a.addItem();case 8:if(""===a.query&&a.pos>0)return a.removeTag(a.pos-1);break;case 46:if(""===a.query&&a.pos<a.tags.length)return a.removeTag(a.pos);break;case 37:if(""===a.query)return a.pos=Math.max(a.pos-1,0),g();break;case 39:if(""===a.query)return a.pos=Math.min(a.pos+1,a.tags.length),g()}},a.handleInputClick=function(a){return a.stopPropagation()},a.handleItemClick=function(b){return a.addItem(),b.stopPropagation()},a.addItem=function(){var b;if(!(a.config.limit&&a.tags.length>=a.config.limit))return b=a.config.disableNew?a.selected>-1?a.matching[a.selected]:null:-1===a.selected&&a.query?a.query:a.selected>-1?a.matching[a.selected]:void 0,b?(a.tags.splice(a.pos,0,b),a.query="",h(),a.selected=Math.min(a.selected,a.matching.length-1),a.pos++,g()):void 0},a.selectItem=function(b){return a.selected=b},a.show=function(){return a.expanded=!0},a.hide=function(){var b;return a.expanded=!1,null!=(b=f())&&"function"==typeof b.blur&&b.blur(),a.pos=a.tags.length},a.removeTag=function(b,c){return null!=c&&"function"==typeof c.stopPropagation&&c.stopPropagation(),a.tags.splice(b,1),b<a.pos&&a.pos--,h(),g()},angular.element(document).bind("click",function(){return a.$apply(function(){return a.hide()})}),h(),e.bind("focus",function(){return a.$apply(function(){return a.show()})})}}}])}.call(this);