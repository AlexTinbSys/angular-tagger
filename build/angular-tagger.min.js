(function(){var e,n,t,a,l;if(angular.module("tagger",[]),angular.version.major<1||1===angular.version.major&&angular.version.minor<3)for(l=["ngKeydown","ngKeyup","ngBlur","ngFocus"],n=function(e){return angular.module("tagger").directive(e,["$parse",function(n){return function(t,a,l){var r,o;return o=n(l[e]),r=angular.lowercase(e.substring(2)),a.bind(r,function(e){return o(t,{$event:e}),t.$$phase||t.$parent.$$phase||t.$root.$$phase?void 0:t.$apply()})}}])},t=0,a=l.length;a>t;t++)e=l[t],n(e);angular.module("tagger").directive("taggerContenteditable",function(){return{require:"ngModel",link:function(e,n,t,a){var l;return n.attr("contenteditable",!0),a.$render=function(){return n.text(a.$viewValue)},l=function(t){return 13===t.keyCode&&null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),e.$apply(function(){return a.$setViewValue(n.text())})},n.bind("keyup",l),n.bind("keydown",l)}}}),angular.module("tagger").directive("tagger",["$compile","$timeout",function(e,n){return{restrict:"AE",replace:!0,template:'<span\n  class="angular-tagger"\n  ng-click="handleOuterClick($event)"\n  ng-class="{\'angular-tagger--single\': config.single}"\n  ng-focus="handleOuterFocus($event)">\n  <span class="angular-tagger__wrapper">\n    <span class="angular-tagger__holder" ng-repeat="tag in tags">\n      <span tagger-contenteditable="true"\n        ng-model="$parent.query"\n        ng-show="pos == $index"\n        ng-keydown="handleKeyDown($event)"\n        ng-keyup="handleKeyUp($event)"\n        ng-click="handleInputClick($event)"\n        ng-blur="handleBlur($index, $event)"\n        class="angular-tagger__input">\n      </span>\n      <span class="angular-tagger__tag">\n        {{ config.displayFun(tag) }}\n        <span\n          class="angular-tagger-tag__delete"\n          ng-mousedown="handleMousedown()"\n          ng-mouseup="handleMouseup()"\n          ng-click="removeTag($index, $event)">x</span>\n      </span>\n    </span>\n  </span>\n  <span tagger-contenteditable="true"\n    ng-model="query"\n    ng-show="(config.single && !tags.length) || (!config.single && pos == tags.length)"\n    ng-keydown="handleKeyDown($event)"\n    ng-keyup="handleKeyUp($event)"\n    ng-click="handleInputClick($event)"\n    placeholder="{{ placeholder }}"\n    ng-blur="handleBlur(tags.length, $event)"\n    ng-focus="handleFocus($event)"\n    class="angular-tagger__input">\n  </span>\n  <div class="angular-tagger__hook">\n    <ul ng-show="expanded" class="angular-tagger__matching">\n      <li class="angular-tagger__matching-item"\n        ng-mousedown="handleMousedown()"\n        ng-mouseup="handleMouseup()"\n        ng-mouseover="selectItem(-1)"\n        ng-click="handleItemClick($event)"\n        ng-hide="config.disableNew || !query.length || hideNew || tags.indexOf(query) != -1 "\n        ng-class=\'{"angular-tagger__matching-item--selected": selected == -1}\'>\n        Add: {{ query }}...\n      </li>\n      <li\n        ng-repeat="e in matching"\n        ng-mousedown="handleMousedown()"\n        ng-mouseup="handleMouseup()"\n        ng-mouseover="selectItem($index)"\n        ng-click="handleItemClick($event)"\n        class="angular-tagger__matching-item"\n        ng-class=\'{"angular-tagger__matching-item--selected": $index == selected}\'>\n        {{ config.displayFun(e) }}\n      </li>\n    </ul>\n  </div>\n</span>',scope:{value:"=ngModel",options:"="},link:function(e,t,a){var l,r,o,i,u,g;return e.query="",e.expanded=!1,e.matching=[],e.selected=0,e.options||(e.options=[]),e.tags||(e.tags=[]),e.placeholder=null,e.hideNew=!1,e.config={disableNew:!1,displayFun:function(e){return e},createFun:function(e){return e},limit:null},null!=a.disableNew&&(e.config.disableNew=null!=a.disableNew),null!=a.limit&&(e.config.limit=parseInt(a.limit)),null!=a.displayFun&&(e.config.displayFun=e.$parent.$eval(a.displayFun)),null!=a.reloadOptions&&(e.config.reloadOptions=e.$parent.$eval(a.reloadOptions)),null!=a.createFun&&(e.config.createFun=e.$parent.$eval(a.createFun)),null!=a.placeholder&&(e.config.placeholder=a.placeholder,e.placeholder=e.config.placeholder),null!=a.single&&(e.config.single=!0,e.config.limit=1),null!=a.onSelect&&(e.config.onSelect=e.$parent.$eval(a.onSelect)),e.config.disableNew&&(e.selected=0),l=t.children().eq(1),g=function(){return n(function(){void 0!=e.config.reloadOptions&&e.query.length>2&&e.config.reloadOptions(e.query);var n,t,a,l,r,o,i,u,g,s,c;for(a=new RegExp(".*"+e.query.split("").join(".*")+".*","i"),e.hideNew=!1,e.matching=[],s=e.options,o=0,u=s.length;u>o;o++)if(t=s[o],l=e.config.displayFun(t),a.test(l)){for(angular.lowercase(l)===angular.lowercase(e.query)&&(e.hideNew=!0),n=!1,c=e.tags,i=0,g=c.length;g>i;i++)r=c[i],r===t&&(n=!0);n||e.matching.push(t)}return e.selected=e.config.disableNew?0:e.matching.length>0?0:-1,e.placeholder=e.tags.length>0?null:e.config.placeholder})},u=function(){return n(function(){return o().focus(),e.show()})},o=function(){return e.pos===e.tags.length?l[0]:t.children().eq(0).children().eq(e.pos).children()[0]},i=function(){return e.config.limit&&e.tags.length>=e.config.limit},e.handleOuterClick=function(n){return null!=n&&"function"==typeof n.stopPropagation&&n.stopPropagation(),e.config.single&&(e.removeTag(0),g()),u()},r=!1,e.handleMousedown=function(){return r=!0},e.handleMouseup=function(){return r=!1},e.handleKeyUp=function(n){var t;switch(n.keyCode){case 8:return g();case 46:return g();case 27:return e.hide();default:if(48<(t=n.keyCode)&&90>t)return g(),e.show()}},e.handleKeyDown=function(n){switch(n.keyCode){case 38:return e.selected=Math.max(e.selected-1,e.config.disableNew?0:-1),n.preventDefault();case 40:return e.selected=Math.min(e.selected+1,e.matching.length-1),n.preventDefault();case 13:return e.addItem();case 8:if(""===e.query&&e.pos>0)return e.removeTag(e.pos-1);break;case 46:if(""===e.query&&e.pos<e.tags.length)return e.removeTag(e.pos);break;case 37:if(""===e.query)return e.pos=Math.max(e.pos-1,0),u();break;case 39:if(""===e.query)return e.pos=Math.min(e.pos+1,e.tags.length),u()}},e.handleInputClick=function(e){return e.stopPropagation()},e.handleItemClick=function(n){return e.addItem(),n.stopPropagation()},e.handleOuterFocus=function(e){var n;return null!=(n=o())&&"function"==typeof n.iffocus?n.focus():void 0},e.handleBlur=function(n,t){return n!==e.pos||r?void 0:e.hide()},e.handleFocus=function(n){return e.show()},e.addItem=function(){var t;if(!i())return t=e.config.disableNew?e.selected>-1?e.matching[e.selected]:null:-1===e.selected&&e.query?e.config.createFun(e.query):e.selected>-1?e.matching[e.selected]:void 0,void 0==e.tags.length&&(e.tags=[],e.pos=0),-1===e.tags.indexOf(t)&&(console.log("adding ",t),e.tags.splice(e.pos,0,t),e.query="",g(),e.selected=Math.min(e.selected,e.matching.length-1),e.pos++,u(),e.config.single&&(e.value=e.tags[0]),n(function(){var n;return"function"==typeof(n=e.config).onSelect?n.onSelect(t):void 0}),i())?e.hide():void 0},e.selectItem=function(n){return e.selected=n},e.show=function(){return e.expanded=!i()},e.hide=function(){return e.expanded=!1,e.query="",e.pos=e.tags.length,n(function(){var e;return null!=(e=o())&&"function"==typeof e.blur?e.blur():void 0})},e.removeTag=function(n,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),e.tags.splice(n,1),e.config.single&&(e.value=e.tags[0]),n<e.pos&&e.pos--,e.expanded&&(g(),u()),e.config.single?e.value=e.tags[0]:void 0},g(),e.$watch("options",g,!0),e.$watch("value",function(){return e.config.single?null!=e.value?e.tags=[e.value]:e.tags=[]:e.tags=e.value||[],e.pos=e.tags.length},!0)}}}])}).call(this);