/*! angular-tagger 2013-08-23 */
!function(){var a,b,c,d,e,f,g;for(angular.module("tagger",[]),f=[["ngKeydown","keydown"],["ngKeyup","keyup"]],c=function(a,b){return angular.module("tagger").directive(a,["$parse",function(c){return function(d,e,f){var g;return g=c(f[a]),e.bind(b,function(a){return d.$apply(function(){return g(d,{$event:a})})})}}])},d=0,e=f.length;e>d;d++)g=f[d],a=g[0],b=g[1],c(a,b);angular.module("tagger").directive("tagger",["$compile","$timeout",function(a,b){return{restrict:"AE",replace:!0,template:'<span class="angular-tagger">\n  <span>\n    <span ng-repeat="tag in tags">\n      <input type="text"\n        ng-model="$parent.query"\n        ng-show="pos == $index"\n        ng-keydown="handleKeyDown($event)"\n        ng-keyup="handleKeyUp($event)"\n        class="angular-tagger_input" />\n      <span class="angular-tagger_tag">\n        {{ tag }}\n        <span class="angular-tagger_tag_delete" ng-click="removeTag($index)">x</span>\n      </span>\n    </span>\n  </span>\n  <input type="text"\n    ng-model="query"\n    ng-show="pos == tags.length"\n    ng-keydown="handleKeyDown($event)"\n    ng-keyup="handleKeyUp($event)"\n    class="angular-tagger_input" />\n  <ul ng-show="expanded" class="angular-tagger_matching">\n    <li class="angular-tagger_matching_item_new"\n      ng-class=\'{"angular-tagger_matching_item_selected": selected == -1}\'>\n      Add: {{ query }}...\n    </li>\n    <li\n      ng-repeat="e in matching"\n      class="angular-tagger_matching_item"\n      ng-class=\'{"angular-tagger_matching_item_selected": $index == selected}\'>\n      {{ e }}\n    </li>\n  </ul>\n</span>',scope:{tags:"=ngModel",options:"="},link:function(a,c){var d,e,f;return a.query="",a.expanded=!1,a.matching=[],a.selected=-1,a.pos=a.tags.length,d=c.children().eq(1),f=function(){var b,c,d,e,f,g,h,i,j,k,l;for(d=new RegExp(".*"+a.query.split("").join(".*")+".*","i"),a.matching=[],j=a.options,l=[],f=0,h=j.length;h>f;f++)if(c=j[f],d.test(c)){for(b=!1,k=a.tags,g=0,i=k.length;i>g;g++)e=k[g],e===c&&(b=!0);b?l.push(void 0):l.push(a.matching.push(c))}else l.push(void 0);return l},e=function(){return b(function(){var b;return b=a.pos===a.tags.length?d[0]:c.children().eq(0).children().eq(a.pos).children()[0],b.focus()})},a.handleKeyUp=function(b){var c;switch(b.keyCode){case 8:return f();case 27:return a.hide();default:if(65<(c=b.keyCode)&&90>c)return f(),a.show(),a.selected=0}},a.handleKeyDown=function(b){switch(b.keyCode){case 38:return a.selected=Math.max(a.selected-1,-1),b.preventDefault();case 40:return a.selected=Math.min(a.selected+1,a.matching.length-1),b.preventDefault();case 13:return a.tags.splice(a.pos,0,a.matching[a.selected]||a.query),a.pos++,a.query="",a.selected=-1,f(),e();case 8:if(""===a.query&&a.pos>0)return a.removeTag(a.pos-1);break;case 37:if(""===a.query)return a.pos=Math.max(a.pos-1,0),e();break;case 39:if(""===a.query)return a.pos=Math.min(a.pos+1,a.tags.length),e()}},a.show=function(){return a.expanded=!0},a.hide=function(){return a.expanded=!1},a.removeTag=function(b){return a.tags.splice(b,1),b<a.pos&&a.pos--,f(),e()},angular.element(document).bind("click",function(){return a.$apply(function(){return a.hide()})}),f(),d.bind("focus",function(){return a.$apply(function(){return a.show()})})}}}])}.call(this);